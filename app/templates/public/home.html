{% extends "base.html" %}

{% block title %}Bienvenido a Antares{% endblock %}

{% block extra_styles %}
<!-- SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block subtitle %}
  <div>
    <h4 class="logo-subtitle">Academy</h4>
  </div>
{% endblock %}

{% block categorias %}
<!-- Categorías públicas -->
<section class="categories-section">
  <h2 class="categories-title">Categories</h2>
  <div class="categories-grid">
    <div class="category-tile" data-category="programming">Programming</div>
    <div class="category-tile" data-category="design">Design</div>
    <div class="category-tile" data-category="marketing">Marketing</div>
    <div class="category-tile" data-category="business">Business</div>
    <div class="category-tile" data-category="photography">Photography</div>
    <div class="category-tile" data-category="languages">Languages</div>
  </div>
</section>
{% endblock %}

{% block cursos %}
<!-- Cursos disponibles -->
<section class="courses-section">
  <h2 class="courses-title">Cursos Disponibles</h2>
  {% if courses %}
    <div class="courses-grid">
      {% for course in courses %}
        <div class="course-card">
          <h3>{{ course.name }}</h3>
          <p>{{ course.description }}</p>

          {% if course.id not in user_courses %}
            <!-- Si el usuario no ha comprado el curso, mostrar el botón de compra -->
            <a href="{{ url_for('user.purchase_course', course_id=course.id) }}" class="btn btn-primary">Comprar Curso</a>
          {% else %}
            <span class="course-purchased">✔ Curso Comprado</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No hay cursos disponibles en este momento.</p>
  {% endif %}
</section>
{% endblock %}

{% block buscador %}
<!--  -->
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const categorias = document.querySelectorAll(".category-tile");
    const user_id = "{{ session.get('user_id') or '' }}";

    categorias.forEach(cat => {
      cat.addEventListener("click", (e) => {
        e.preventDefault();

        if (!user_id) {
          Swal.fire({
            icon: 'info',
            title: 'Inicia sesión',
            text: 'Debes iniciar sesión o registrarte para acceder a esta categoría.',
            confirmButtonText: 'Entendido'
          });
        } else {
          const category = cat.getAttribute("data-category");
          window.location.href = `/courses/${category}`;
        }
      });
    });
  });
</script>
{% endblock %}
